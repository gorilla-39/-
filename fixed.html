<!--Hey Sam!!!!!!! Ill use Dreamer(Reinforcement lerning) what do u think about it? if you agree it,ill dev it.-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Gleam Games v2</title>
  <style>
    .card.selected {
  border: 2px solid red;
  box-sizing: border-box;
}
/* ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ */
.card.selected {
  border: 2px solid red;
  box-sizing: border-box;
}
/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ‰‹æœ­ã®ã‚³ãƒ³ãƒ†ãƒŠ */
#player-hand {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin: 10px 0;
}

/* CPUã®æ‰‹æœ­æšæ•°è¡¨ç¤ºç”¨ */
.cpu-hand-count {
  margin: 5px 0;
  font-size: 0.9em;
  color: #ddd;
}

/* ã‚¿ãƒ¼ãƒ³ã‚„çŠ¶æ…‹è¡¨ç¤ºã®ä½™ç™½èª¿æ•´ */
#turn-indicator, #gleam-info, #daifugo-result {
  margin-top: 10px;
  min-height: 24px;
}

/* ã‚«ãƒ¼ãƒ‰ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
.card {
  border: 1px solid #ccc;
  padding: 8px;
  margin: 2px;
  background-color: #222;
  cursor: pointer;
  border-radius: 4px;
}

/* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åŠ¹æœ */
button:hover {
  background-color: #333;
}

/* ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.game-area {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

/* ãƒ€ã‚¤ã‚¹çµæœã®è‰² */
#dice-result {
  color: #FFD700;
}


    body {
      font-family: Arial;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      background-color: #111;
      color: white;
    }
    h1, h2, h3 {
      color: #FFFFFF;
    }
    h2 { margin-top: 30px; }
    .hidden { display: none; }
    .inputs {
      padding: 6px 0 6px 0;
      margin: 5px 0;
      width: 100%;
      background-color: #222;
      border: 1px solid #444;
      color: white;
    }
    .buttons {
      padding: 6px;
      margin: 5px 0;
      width: 100%;
      background-color: #222;
      border: 1px solid #444;
      color: white;
    }
    .half_buttons {
      padding: 6px;
      margin: 5px 0;
      width: 49.4%;
      background-color: #222;
      border: 1px solid #444;
      color: white;
      display: inline-block;
    }
    button:hover { background-color: #333; }
    /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ‰‹æœ­ã®ã‚³ãƒ³ãƒ†ãƒŠ */
#player-hand {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin: 10px 0;
}

/* CPUã®æ‰‹æœ­æšæ•°è¡¨ç¤ºç”¨ */
.cpu-hand-count {
  margin: 5px 0;
  font-size: 0.9em;
  color: #ddd;
}

/* ã‚¿ãƒ¼ãƒ³ã‚„çŠ¶æ…‹è¡¨ç¤ºã®ä½™ç™½èª¿æ•´ */
#turn-indicator, #gleam-info, #daifugo-result {
  margin-top: 10px;
  min-height: 24px;
}

    .metrics { margin: 10px 0; font-weight: bold; }
    .game-area {
      background-color: #333;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0 20px 0;
    }
    #dice-result { color: #FFD700; }
  </style>
</head>
<body>
  <h1>Gleam Games</h1>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
  <div id="login-area">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <input id="username" class="inputs" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
    <input id="password" class="inputs" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button class="buttons" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <button class="buttons" onclick="register()">æ–°è¦ç™»éŒ²</button>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
  <div id="main-area" class="hidden">
    <h2 id="welcome-text"></h2>
    <div class="metrics">ğŸ’° Gleam: <span id="gleam">0</span></div>
    <div class="metrics">å€Ÿé‡‘: <span id="debt">0</span></div>

    <h3>ğŸ’¼ å–å¼•æ‰€</h3>
    <input id="amount" class="inputs" type="number" placeholder="é‡‘é¡ã‚’å…¥åŠ›">
    <div style="text-align: center">
        <button class="half_buttons" onclick="borrow()">å€Ÿã‚Šã‚‹</button>
        <button class="half_buttons" onclick="repay()">è¿”æ¸ˆã™ã‚‹</button>
    </div>

    <div class="game-area">
        <h3>ğŸ² ãƒãƒ³ãƒãƒ­ãƒªãƒ³</h3>
        <button id="tintiro-btn" class="buttons" onclick="toggleGame('tintiro')">ãƒãƒ³ãƒãƒ­ãƒªãƒ³ã§éŠã¶</button>
        <div id="tintiro-area" class="hidden" >
            <input id="tintiro-bet" class="inputs" type="number" placeholder="æ›ã‘é‡‘ (Gleam)">
            <button class="buttons" onclick="rollDice()">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
            <div id="tintiro-result"></div>
            <button class="buttons" onclick="toggleGame('tintiro')">çµ‚äº†</button>
        </div>
    </div>

    <div class="game-area">
      <h3>ğŸƒ ãƒ–ãƒ©ãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚¯</h3>
      <button id="blackjack-btn" class="buttons" onclick="toggleGame('blackjack')">ãƒ–ãƒ©ãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚¯ã§éŠã¶</button>
      <div id="blackjack-area" class="hidden">
        <input id="blackjack-bet" class="inputs" type="number" placeholder="æ›ã‘é‡‘ (Gleam)">
        <button id="start-button"  class="buttons" onclick="startGame()">é–‹å§‹</button>
        <div style="text-align:center">
          <button id="hit-button"       class="half_buttons hidden" onclick="hit()">ãƒ’ãƒƒãƒˆ</button>
          <button id="stand-button"     class="half_buttons hidden" onclick="stand()">ã‚¹ã‚¿ãƒ³ãƒ‰</button><br>
          <button id="double-button"    class="half_buttons hidden" onclick="doubleDown()">ãƒ€ãƒ–ãƒ«ãƒ€ã‚¦ãƒ³</button>
          <button id="surrender-button" class="half_buttons hidden" onclick="surrender()">ã‚µãƒ¬ãƒ³ãƒ€ãƒ¼</button>
        </div>
        <div id="blackjack-result"></div>
        <button class="buttons" onclick="toggleGame('blackjack')">çµ‚äº†</button>
      </div>
    </div>


    
<!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
<div class="game-area">
  <h3>ğŸƒ å¤§å¯Œè±ª</h3>

  <!-- ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
  <div id="daifugo-mode-select">
    <button class="half_buttons" onclick="setDaifugoMode('player')">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾æˆ¦</button>
    <button class="half_buttons" onclick="setDaifugoMode('cpu')">CPUå¯¾æˆ¦</button>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
  <div id="daifugo-area" class="hidden">
    <!-- æ›ã‘é‡‘å…¥åŠ›ã¨ã‚²ãƒ¼ãƒ é–‹å§‹ -->
    <input id="daifugo-bet" class="inputs" type="number" placeholder="æ›ã‘é‡‘ (Gleam)" min="0" />
    <button id="start-button" class="buttons" onclick="startGame()">é–‹å§‹</button>

    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
    <div style="text-align:center; margin-top:10px;">
      <button id="put-button" class="half_buttons hidden" onclick="putout()">ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™</button>
      <button id="pass-button" class="half_buttons hidden" onclick="pass()">ãƒ‘ã‚¹</button><br>
    </div>

    <!-- æ‰‹æœ­è¡¨ç¤º -->
    <div id="player-hand" style="margin: 10px 0; display: flex; flex-wrap: wrap; gap: 5px;"></div>

    <!-- çŠ¶æ…‹è¡¨ç¤º -->
    <div id="turn-indicator" style="margin-top: 10px; font-weight:bold;"></div>
    <div id="gleam-info" style="margin-bottom: 10px; color:#555;"></div>

    <!-- çµæœè¡¨ç¤º -->
    <div id="daifugo-result" style="white-space: pre-wrap; margin-top: 10px; font-weight: bold; color: #333;"></div>

    <!-- çµ‚äº†ãƒœã‚¿ãƒ³ -->
    <button class="buttons" onclick="toggleGame('daifugo')">çµ‚äº†</button>
  </div>
</div>



  
  <script>
    //===== set indexedDB functions (like LocalStorage) ====
    const DB_NAME = "Gleam";
    const STORE_NAME = "GleamFireStore";
    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, 1);
            request.onerror = (event) => reject("DB open error");
            request.onsuccess = (event) => resolve(event.target.result);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME);
                };
            };
        });
    }
    async function setItem(key, value) {
        const db = await openDB();
        const tx = db.transaction(STORE_NAME, "readwrite");
        const store = tx.objectStore(STORE_NAME);
        store.put(value, key);
        return tx.complete;
    }
    async function getItem(key) {
        const db = await openDB();
        const tx = db.transaction(STORE_NAME, "readonly");
        const store = tx.objectStore(STORE_NAME);
        return new Promise((resolve, reject) => {
            const request = store.get(key);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject("Get error");
        });
    }

    //currentUserã‚’guestï¼ˆåŒ¿åï¼‰ã«ã—ã¨ã„ã¦ã€
    let currentUser = 'guest';
    let users = getItem("users").then(content => JSON.parse(content || "{}"));
    let user;
    
    // åˆå›ã®ã¿5000 Gleamã‚’è¨­å®š
    if (!users['guest']) {
      users['guest'] = { password: '', gleam: 5000, debt: 0 };
      saveUsers();
    }
    
    function saveUsers() {
      setItem("users", JSON.stringify(users));
    }
    
    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (users[u] && users[u].password === p) {
        currentUser = u;
        alert("ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†");
        showMain();
      } else {
        alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—");
      }
    }
    
    function register() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (!users[u]) {
        users[u] = { password: p, gleam: 5000, debt: 0 };
        saveUsers();
        currentUser = u;
        alert("ç™»éŒ²å®Œäº†");
        showMain();
      } else {
        alert("ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™");
      } 
    }
    
    function showMain() {
      document.getElementById("login-area").style.display = "none";
      document.getElementById("main-area").style.display = "block";
      document.getElementById("welcome-text").textContent = `ã‚ˆã†ã“ãã€${currentUser}ã•ã‚“`;
      updateMetrics();
    }
    
    function updateMetrics() {
      document.getElementById("gleam").textContent = users[currentUser].gleam;
      document.getElementById("debt").textContent = users[currentUser].debt;
    }
    
    function borrow() {
      const val = parseInt(document.getElementById("amount").value);
      if (val > 0 && val<=10000) {
        users[currentUser].gleam += val;
        users[currentUser].debt += Math.ceil(val * 1.01);
        saveUsers();
        updateMetrics();
      } else {
        alert("æœ‰åŠ¹ãªæ•°å­—ã‚’å…¥åŠ›ã—ã¦")
      }
    }
    
    function repay() {
      const val = parseInt(document.getElementById("amount").value, 10);
      const user = users[currentUser];
      const repayAmount = Math.min(val, user.debt, user.gleam);
      if (repayAmount > 0) {
        user.gleam -= repayAmount;
        user.debt -= repayAmount;
        saveUsers();
        updateMetrics();
      }
    }
    
    let loadedScriptGames = [];
    function toggleGame(GameName) {
      //this is based on what game area have same name elements.
      //such as btn: GameName + "btn". area: GameName + "area". script path: "/-/scripts/" + GameName + ".js"
      const gameArea = document.getElementById(`${GameName}-btn`);
      const startGameBtn = document.getElementById(`${GameName}-area`);

      // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã‘ã‚Œã°è¡¨ç¤ºã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°éè¡¨ç¤º
      gameArea.classList.toggle("hidden");
      startGameBtn.style.display = gameArea.classList.contains("hidden") ? "block" : "none";
      
      if (!loadedScriptGames.includes(GameName)) {
        loadedScriptGames.push(GameName);
        let GameScript = document.createElement("script");
        GameScript.src = `/-/scripts/${GameName}.js`;
        document.body.appendChild(GameScript);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById("login-area").style.display = "block"; // åˆæœŸè¡¨ç¤ºã§ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
    });
  </script>
</body>
</html>
