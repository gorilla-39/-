<!DOCTYPE html>   <!--ã™ã¾ã‚“ã‚µãƒ ã•ã‚“ãƒ¯ã‚¤ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ å¤§ã¾ã‹ãªæ§‹æˆé †ã¨ã‚«ã‚¸ãƒã®éƒ¨åˆ†ã®ä¸­èº«ä½•æ›¸ã„ã¦ã‚‹ã‹ã—ã‹çŸ¥ã‚‰ãªã„ã‹ã‚‰å¤‰æ›´ã™ã‚‹ãªã‚‰å‹æ‰‹ã«ã—ã¦ã‚¯ãƒ¬ãƒ¡ãƒ³ã‚¹-->
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Gleam ãƒãƒ³ãƒãƒ­ãƒªãƒ³</title>
  <style>
    body { 
      font-family: Arial; 
      padding: 20px; 
      max-width: 700px; 
      margin: auto; 
      background-color: #111;
      color: white;
    }
    h1, h2, h3 { 
      color: #FFFFFF;
    }
    h2 { margin-top: 30px; }
    .hidden { display: none; }
    input, button { 
      padding: 6px; 
      margin: 5px 0; 
      width: 100%; 
      background-color: #222; 
      border: 1px solid #444;
      color: white;
    }
    button:hover { background-color: #333; }
    .metrics { margin: 10px 0; font-weight: bold; }
    #game-area {
      background-color: #333;
      padding: 20px;
      border-radius: 8px;
    }
    #dice-result { color: #FFD700; }
  </style>
</head>
<body>
  <h1>Gleam ãƒãƒ³ãƒãƒ­ãƒªãƒ³</h1>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
  <div id="login-area">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <input id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
    <input id="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <button onclick="register()">æ–°è¦ç™»éŒ²</button>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
  <div id="main-area" class="hidden">
    <h2 id="welcome-text"></h2>
    <div class="metrics">ğŸ’° Gleam: <span id="gleam">0</span></div>
    <div class="metrics">å€Ÿé‡‘: <span id="debt">0</span></div>

    <h3>ğŸ’¼ å–å¼•æ‰€</h3>
    <input id="amount" type="number" placeholder="é‡‘é¡ã‚’å…¥åŠ›">
    <button onclick="borrow()">å€Ÿã‚Šã‚‹</button>
    <button onclick="repay()">è¿”æ¸ˆã™ã‚‹</button>

    <h3>ğŸ² ãƒãƒ³ãƒãƒ­ãƒªãƒ³</h3>
    <button id="start-game-btn" onclick="toggleGame()">ãƒãƒ³ãƒãƒ­ãƒªãƒ³ã§éŠã¶</button>
    <div id="game-area" class="hidden">
      <input id="bet" type="number" placeholder="æ›ã‘é‡‘ (Gleam)">
      <button onclick="rollDice()">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
      <div id="dice-result"></div>
      <button onclick="toggleGame()">çµ‚äº†</button>
    </div>
  </div>

  <script>
    let currentUser = 'guest';
    let users = JSON.parse(localStorage.getItem("users") || "{}");// FIMXE: localStorageã«ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä¿å­˜ã™ã‚“ãªã€‚æ›¸ãæ›ãˆã‚“ãã€‚

    // åˆå›ã®ã¿5000 Gleamã‚’è¨­å®š
    if (!users['guest']) {
      users['guest'] = { password: '', gleam: 5000, debt: 0 };
      saveUsers();
    }

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users)); //FIXME: ä»£ã‚ã‚Šã«indexedDBä½¿ãˆ
    }

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (users[u] && users[u].password === p) {
        currentUser = u;
        alert("ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†");
        showMain();
      } else {
        alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—");
      }
    }

    function register() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (!users[u]) {
        users[u] = { password: p, gleam: 5000, debt: 0 };
        saveUsers();
        currentUser = u;
        alert("ç™»éŒ²å®Œäº†");
        showMain();
      } else {
        alert("ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™");
      } 
    }

    function showMain() {
      document.getElementById("login-area").style.display = "none";
      document.getElementById("main-area").style.display = "block";
      document.getElementById("welcome-text").textContent = `ã‚ˆã†ã“ãã€${currentUser}ã•ã‚“`;
      updateMetrics();
    }

    function updateMetrics() {
      document.getElementById("gleam").textContent = users[currentUser].gleam;
      document.getElementById("debt").textContent = users[currentUser].debt;
    }

    function borrow() {
      const val = parseInt(document.getElementById("amount").value);
      if (val > 0) {
        users[currentUser].gleam += val;
        users[currentUser].debt += Math.ceil(val * 1.01);
        saveUsers();
        updateMetrics();
      }
    }

    function repay() {
      const val = parseInt(document.getElementById("amount").value); //TODO: ç¬¬äºŒå¼•æ•°ã«åŸºæ•°æŒ‡å®šã—ã‚
      const user = users[currentUser];
      const repayAmount = Math.min(val, user.debt, user.gleam);
      if (repayAmount > 0) {
        user.gleam -= repayAmount;
        user.debt -= repayAmount;
        saveUsers();
        updateMetrics();
      }
    }

    function toggleGame() {
      const gameArea = document.getElementById("game-area");
      const startGameBtn = document.getElementById("start-game-btn");
      
      // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã‘ã‚Œã°è¡¨ç¤ºã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°éè¡¨ç¤º
      gameArea.classList.toggle("hidden");
      startGameBtn.style.display = gameArea.classList.contains("hidden") ? "block" : "none";

      // ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹ãƒœã‚¿ãƒ³ã‚‚ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ã§éè¡¨ç¤ºã«
      if (gameArea.classList.contains("hidden")) {
        document.getElementById("bet").value = ""; // ãƒ™ãƒƒãƒˆé¡ãƒªã‚»ãƒƒãƒˆ
        document.getElementById("dice-result").textContent = ""; // å‡ºç›®ã®ãƒªã‚»ãƒƒãƒˆ
      }
    }

    function rollDice() {
      const betInput = document.getElementById("bet").value.trim();
      const bet = parseInt(betInput); //TODO: ã“ã“ã‚‚åŸºæ•°æŒ‡å®šã—ã‚
      const user = users[currentUser];

      if (betInput === "" || isNaN(bet)) {
        alert("è³­ã‘é‡‘ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      if (bet <= 0 || bet > user.gleam) {
        alert("æœ‰åŠ¹ãªè³­ã‘é‡‘ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      const dice = [1, 2, 3].map(() => Math.floor(Math.random() * 6) + 1);
      let result = `å‡ºç›®: ${dice.join(", ")}<br>`;
      const sorted = [...dice].sort();
      let payout = 0;

      //å€‹äººçš„ã«ã¯ã“ã“ã¯åˆ¥é–¢æ•°ã«ã—ã¦ã€Œã©ã‚“ãªå‡ºç›®ã‹ã€ã¨ã‹ã‚’è¿”ã—ã¦ã‚‚ã‚‰ã£ãŸä¸Šã§swith-caseã§ã‚„ã£ãŸã»ã†ãŒç¶ºéº—ãªæ°—ãŒã™ã‚‹
      if (dice[0] === dice[1] && dice[1] === dice[2]) {
        payout = dice[0] === 1 ? bet * 6 : bet * 4; // ãƒ”ãƒ³ã‚¾ãƒ­5å€ã€ã‚¾ãƒ­ç›®3å€
        result += dice[0] === 1 ? "ãƒ”ãƒ³ã‚¾ãƒ­ï¼5å€ï¼" : "ã‚¾ãƒ­ç›®ï¼3å€ï¼";
      } else if (sorted.join() === "1,2,3") {
        payout = -bet; // ãƒ’ãƒ•ãƒŸ-2å€
        result += "ãƒ’ãƒ•ãƒŸï¼ãƒã‚¤ãƒŠã‚¹2å€ï¼";
      } else if (sorted.join() === "4,5,6") {
        payout = bet * 3; // ã‚·ã‚´ãƒ­2å€
        result += "ã‚·ã‚´ãƒ­ï¼2å€ï¼";
      } else if (new Set(dice).size === 2) {
        payout = bet*2; // ãƒ¯ãƒ³ãƒšã‚¢ç­‰å€
6        result += "ãƒ¯ãƒ³ãƒšã‚¢ï¼1å€ï¼";
      } else {
        payout = 0; // ç›®ç„¡ã—0å€
        result += "ãƒãƒŸï¼ˆãƒãƒ©ãƒãƒ©ï¼‰ï¼ãƒã‚¤ãƒŠã‚¹1å€ï¼";
      }

      user.gleam += payout - bet;
      if (user.gleam < 0) user.gleam = 0;
      saveUsers();
      updateMetrics();
      document.getElementById("dice-result").innerHTML = result;
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById("login-area").style.display = "block"; // åˆæœŸè¡¨ç¤ºã§ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
    });
  </script>
</body>
</html>
